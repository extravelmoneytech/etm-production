<section>
    <h1 id="title" class="text-base md:text-xl text-black font-bold tracking-tight mb-3">
        Rates for Forex Card and Currencies in Major Cities in India
    </h1>

    <div class="relative md:border w-full rounded-lg overflow-hidden">
        <!-- Table for desktop view -->
        <div class="hidden sm:block overflow-x-auto">
            <table class="w-full text-sm text-left font-['Plus Jakarta Sans']" id="ratesTable">
                <thead class="bg-[#2c5aa2]">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-white font-semibold">
                            <div class="flex items-center gap-4">
                                <span>City</span>
                                <div class="flex items-center bg-white/10 rounded px-2 py-1 space-x-2 mt-2 sm:mt-0">
                                    <span class="text-xs sm:text-sm text-white"><?php echo $currency; ?> </span>
                                </div>
                            </div>
                        </th>
                        <th scope="col" class="px-6 py-3 text-white font-semibold">Currency</th>
                        <th scope="col" class="px-6 py-3 text-white font-semibold">Forex Card</th>
                    </tr>
                </thead>
                <tbody class="bg-gray-50 divide-y divide-gray-200" id="ratesTableBody">
                    <!-- Cities in specified order -->
                    <tr data-city="Mumbai">
                        <th class="px-6 py-4 text-sm font-medium text-gray-900">Mumbai</th>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                    </tr>
                    <tr data-city="New Delhi">
                        <th class="px-6 py-4 text-sm font-medium text-gray-900">New Delhi</th>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                                
                    </tr>
                    <tr data-city="Chennai">
                        <th class="px-6 py-4 text-sm font-medium text-gray-900">Chennai</th>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                    </tr>
                    <tr data-city="Kolkata">
                        <th class="px-6 py-4 text-sm font-medium text-gray-900">Kolkata</th>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                    </tr>
                    <tr data-city="Pune">
                        <th class="px-6 py-4 text-sm font-medium text-gray-900">Pune</th>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                    </tr>
                    <tr data-city="Hyderabad">
                        <th class="px-6 py-4 text-sm font-medium text-gray-900">Hyderabad</th>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                    </tr>
                    <tr data-city="Bangalore">
                        <th class="px-6 py-4 text-sm font-medium text-gray-900">Bangalore</th>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                    </tr>
                    <tr data-city="Ahmedabad">
                        <th class="px-6 py-4 text-sm font-medium text-gray-900">Ahmedabad</th>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold placeholder"><div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>
</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Mobile view -->
        <div class="block sm:hidden w-full max-w-2xl" id="mobileView">
            <div data-city="Mumbai" class="p-4 border-b border-gray-200 last:border-b-0">
                <h3 class="text-sm font-bold text-gray-900 mb-3">Mumbai</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Currency</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Forex Card</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                </div>
            </div>
            <div data-city="New Delhi" class="p-4 border-b border-gray-200 last:border-b-0">
                <h3 class="text-sm font-bold text-gray-900 mb-3">New Delhi</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Currency</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Forex Card</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                </div>
            </div>
            <div data-city="Chennai" class="p-4 border-b border-gray-200 last:border-b-0">
                <h3 class="text-sm font-bold text-gray-900 mb-3">Chennai</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Currency</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Forex Card</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                </div>
            </div>
            <div data-city="Kolkata" class="p-4 border-b border-gray-200 last:border-b-0">
                <h3 class="text-sm font-bold text-gray-900 mb-3">Kolkata</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Currency</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Forex Card</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                </div>
            </div>
            <div data-city="Pune" class="p-4 border-b border-gray-200 last:border-b-0">
                <h3 class="text-sm font-bold text-gray-900 mb-3">Pune</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Currency</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Forex Card</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                </div>
            </div>
            <div data-city="Hyderabad" class="p-4 border-b border-gray-200 last:border-b-0">
                <h3 class="text-sm font-bold text-gray-900 mb-3">Hyderabad</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Currency</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Forex Card</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                </div>
            </div>
            <div data-city="Bangalore" class="p-4 border-b border-gray-200 last:border-b-0">
                <h3 class="text-sm font-bold text-gray-900 mb-3">Bangalore</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Currency</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Forex Card</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                </div>
            </div>
            <div data-city="Ahmedabad" class="p-4 border-b border-gray-200 last:border-b-0">
                <h3 class="text-sm font-bold text-gray-900 mb-3">Ahmedabad</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Currency</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                    <div class="flex flex-col space-y-1">
                        <span class="text-sm text-[#666]">Forex Card</span>
                        <span class="text-sm font-bold text-[#666]"> <div class="w-full h-8 px-4 animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>

</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams({
            action: 'top_city_rates',
            currency: '<?php echo $currency; ?>'
        });

        try {
            fetch('https://mvc.extravelmoney.com/api-etm-elements/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: params.toString(),
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // console.log(data.top_city_rates);

                    updateTable(data.top_city_rates);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        } catch (error) {
            console.error(error);
        }
    });

    function updateTable(rates) {
    const tableBody = document.querySelector('#ratesTableBody');
    const mobileView = document.querySelector('#mobileView');
    const titleElement = document.getElementById('title');
    let shouldHideForexCardColumn = true; // Assume the column should be hidden initially

    // Update both desktop table and mobile view
    Object.entries(rates).forEach(([city, rate]) => {
        // Update desktop table
        const row = tableBody.querySelector(`tr[data-city="${city}"]`);
        if (row) {
            const currencyCell = row.children[1];
            const cardCell = row.children[2];

            // Update currency value
            animateValue(currencyCell, `₹${rate.buy_currency}`);

            // Update Forex Card value if not 0
            if (rate.buy_card && rate.buy_card !== 0) {
                animateValue(cardCell, `₹${rate.buy_card}`);
                shouldHideForexCardColumn = false; // Keep the column visible
            } else {
                cardCell.textContent = ""; // Clear value
            }
        }

        // Update mobile view
        const mobileCard = mobileView.querySelector(`div[data-city="${city}"]`);
        if (mobileCard) {
            const currencyCell = mobileCard.querySelector('.flex-col:nth-child(1) span:last-child');
            const cardCell = mobileCard.querySelector('.flex-col:nth-child(2) span:last-child');

            if (currencyCell) {
                animateValue(currencyCell, `₹${rate.buy_currency}`);
            }

            if (rate.buy_card && rate.buy_card !== 0) {
                animateValue(cardCell, `₹${rate.buy_card}`);
                shouldHideForexCardColumn = false; // Keep the column visible
            } else {
                cardCell.textContent = ""; // Clear value
            
            }
        }
    });
    if (shouldHideForexCardColumn == true) {
    titleElement.textContent = "Rates for Currencies in Major Cities in India";
} else if (titleElement) {
    titleElement.textContent = "Rates for Forex Card and Currencies in Major Cities in India";
}
    // Hide or show the Forex Card column based on the value of rate_buy_card
    const forexCardHeader = document.querySelector('th:nth-child(3)'); // Header for Forex Card
    const forexCardCells = document.querySelectorAll('td:nth-child(3)'); // All Forex Card cells

    if (shouldHideForexCardColumn) {
        // Hide the column
        if (forexCardHeader) forexCardHeader.style.display = 'none';
        forexCardCells.forEach(cell => (cell.style.display = 'none'));

        // Hide mobile Forex Card details
        const mobileForexCardElements = mobileView.querySelectorAll(
            '.flex-col:nth-child(2)'
        );
        mobileForexCardElements.forEach(element => {
            element.style.display = 'none';
        });
    } else {
        // Show the column
        if (forexCardHeader) forexCardHeader.style.display = '';
        forexCardCells.forEach(cell => (cell.style.display = ''));

        // Show mobile Forex Card details
        const mobileForexCardElements = mobileView.querySelectorAll(
            '.flex-col:nth-child(2)'
        );
        mobileForexCardElements.forEach(element => {
            element.style.display = '';
        });
    }
}

    function setContent(element, content) {
        element.innerHTML = content; // Replace spinner with actual value
    }
    function animateValue(cell, newValue) {
        cell.classList.add('opacity-0'); // Fade out
        setTimeout(() => {
            cell.textContent = newValue; // Update value
            cell.classList.remove('opacity-0'); // Fade in
            cell.classList.add('opacity-100');
        }, 300);
    }
</script>

<style>
    .opacity-0 {
        opacity: 0;
        transition: opacity 0.3s ease-out;
    }

    .opacity-100 {
        opacity: 1;
        transition: opacity 0.3s ease-in;
    }



    @keyframes pulse {
        0%,
        100% {
            opacity: 1;
        }
        50% {
            opacity: 0.5;
        }
    }
    .animate-pulse {
        animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
</style>